{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>All Courses | Bildung</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8f9fa;
    }

    .course-card {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .course-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    h2 {
      margin-bottom: 1.5rem;
    }
  </style>
</head>

<body>

<div class="d-flex justify-content-between align-items-center px-4 py-3 bg-white shadow-sm">

  <a href="{% url 'student_dashboard' %}" class="text-decoration-none text-dark">
        <h3 class="m-0 fw-bold"><i class="fas fa-graduation-cap"></i> Bildung</h3>
    </a>

  <div class="d-flex align-items-center gap-3">

    {% if user.is_authenticated %}

      {% if user.role == "student" %}

        <div class="dropdown">
          <button
            class="btn rounded-circle shadow-sm"
            style="background:gray;color:white;width:45px;height:45px;"
            data-bs-toggle="dropdown">
            {{ request.user.username|first|upper }}
          </button>

          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="{% url 'profile_view' %}">Profile</a></li>
            <li><a class="dropdown-item" href="{% url 'student:my_courses' %}">My Courses</a></li>
            <li><a class="dropdown-item" href="{% url 'student_my_activity' %}">My Activity</a></li>
            <li><a class="dropdown-item" href="{% url 'student:student_upcoming_classes' %}">My Schedules</a></li>
            <li><a class="dropdown-item" href="{% url 'student:my_certificates' %}">My Certificates</a></li>
            <li><a class="dropdown-item" href="{% url 'student_notifications' %}">Notifications</a></li>
            <li><a class="dropdown-item" href="#">Payments</a></li>
            <li><a class="dropdown-item" href="#">Help & Support</a></li>
            <li><a class="dropdown-item" href="{% url 'account_settings' %}">Account Settings</a></li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a class="dropdown-item text-danger" href="{% url 'logout_view' %}">
                Logout
              </a>
            </li>
          </ul>
        </div>
      {% endif %}

      {% if user.role == "instructor" %}
        <span class="fw-semibold">Hello, {{ user.first_name }}</span>

        <div class="dropdown">
          <button
            class="btn rounded-circle shadow-sm"
            style="background:#0d6efd;color:white;width:45px;height:45px;"
            data-bs-toggle="dropdown">
            {{ request.user.username|first|upper }}
          </button>

          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="{% url 'instructor_profile_view' %}">Profile</a></li>
            <li><a class="dropdown-item" href="{% url 'instructor:add_course' %}">Create New Course</a></li>
            <li><a class="dropdown-item" href="{% url 'instructor:students_list' %}">My Students</a></li>
            <li><a class="dropdown-item" href="{% url 'instructor:calendar_view' %}">My Schedules</a></li>
            <li><a class="dropdown-item" href="{% url 'instructor_notifications' %}">Notifications</a></li>
            <li><a class="dropdown-item" href="#">Earnings & Payments</a></li>
            <li><a class="dropdown-item" href="#">Help & Support</a></li>
            <li><a class="dropdown-item" href="{% url 'instructor_account_settings' %}">Account Settings</a></li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a class="dropdown-item text-danger" href="{% url 'logout_view' %}">
                Logout
              </a>
            </li>
          </ul>
        </div>
      {% endif %}

    {% else %}
      <a href="{% url 'auth_page' %}" class="btn btn-primary">Sign Up</a>
    {% endif %}

  </div>
</div>

<section class="container my-4">

  {% if query %}
    <h2>Search Results for "{{ query }}"</h2>
  {% else %}
    <h2>All Courses</h2>
  {% endif %}

  <div class="row">
    {% for course in courses %}
      <div class="col-md-4 col-sm-6 mb-4">
        <div class="card course-card h-100">

          {% if course.thumbnail %}
            <img src="{{ course.thumbnail.url }}"
                 class="card-img-top"
                 style="height:180px;object-fit:cover;">
          {% endif %}

          <div class="card-body d-flex flex-column">
            <h5 class="fw-bold">{{ course.title }}</h5>
            <p class="text-muted small">
              {{ course.description|truncatewords:18 }}
            </p>

            <p class="mb-2">
              <strong>Category:</strong> {{ course.category|title }}
            </p>

            {% if user.is_authenticated and user.role == 'instructor' %}
              <a href="{% url 'instructor:course_detail' course.id %}"
                 class="btn btn-outline-primary mt-auto">
                View Course
              </a>

            {% elif user.is_authenticated and user.role == 'student' %}
              {% if course.id in enrolled_course_ids %}
                <a href="{% url 'student:student_course_detail' course.id %}"
                   class="btn btn-primary mt-auto">
                  View Course
                </a>
              {% else %}
                <a href="{% url 'courses:view_course' course.id %}"
                   class="btn btn-primary mt-auto">
                  Enroll Now
                </a>
              {% endif %}

            {% else %}
              <a href="{% url 'courses:view_course' course.id %}"
                 class="btn btn-primary mt-auto">
                View Details
              </a>
            {% endif %}
          </div>
        </div>
      </div>
    {% empty %}
      <div class="text-center text-muted">
        <p>No courses found.</p>
      </div>
    {% endfor %}
  </div>

</section>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
