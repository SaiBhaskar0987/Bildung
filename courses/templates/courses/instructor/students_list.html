{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Students</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>

body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: #f3f4f6;
}

.main-content {
    max-width: 1500px;   
    margin: auto;
    padding: 30px 20px;
}

.page-title {
    font-size: 30px;
    font-weight: 700;
    color: #111827;
    margin-bottom: 10px;
}

.search-wrapper {
    display: flex;
    justify-content: flex-end;  
    margin-bottom: 25px;
}

.search-bar-inner {
    background: #fff;
    padding: 10px 18px;
    border-radius: 999px;
    width: 350px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    display: flex;
    align-items: center;
    gap: 10px;
}

.search-bar-inner input {
    border: none;
    outline: none;
    flex: 1;
    font-size: 15px;
}

.title-search-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
}

.page-title {
    font-size: 28px;
    font-weight: 700;
    margin: 0;
    color: #111827;
}

.search-bar-inline {
    margin: 0;
}

.search-bar-inner {
    background: #fff;
    padding: 10px 18px;
    border-radius: 999px;
    width: 350px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    display: flex;
    align-items: center;
    gap: 10px;
}

.search-bar-inner input {
    border: none;
    outline: none;
    flex: 1;
    font-size: 15px;
}

.search-bar-inner i {
    color: #9ca3af;
    font-size: 14px;
}

.stats {
    display: grid;
    grid-template-columns: repeat(4,1fr);
    gap: 20px;
    margin-bottom: 35px;
}

.stat-card {
    background: #fff;
    padding: 20px;
    border-radius: 18px;
    box-shadow: 0 3px 12px rgba(0,0,0,0.07);
    display: flex;
    align-items: center;
    gap: 14px;
}

.stat-icon {
    width: 45px;
    height: 45px;
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #fff;
}

.stat-1 .stat-icon { background: #2563eb; }
.stat-2 .stat-icon { background: #10b981; }
.stat-3 .stat-icon { background: #a855f7; }
.stat-4 .stat-icon { background: #f59e0b; }

.students-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 26px;
}

.student-card {
    background: #fff;
    border-radius: 20px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.08);
    overflow: visible;
    position: relative;
}

.student-card .top-banner {
    height: 90px;
    background: linear-gradient(90deg, #1e3a8a, #3b82f6);
    border-radius: 20px 20px 0 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.student-avatar {
    font-size: 28px;
    color: white;
}

.student-info {
    padding: 16px;
}

.student-name {
    font-weight: 700;
    margin-bottom: 3px;
}

.student-email {
    font-size: 13px;
    color: #6b7280;
    margin-bottom: 15px;
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: #e5e7eb;
    border-radius: 999px;
    overflow: hidden;
}

.progress-fill {
    height: 8px;
    background: #22c55e;
}

.progress-text {
    font-size: 12px;
    margin-top: 4px;
    color: #666;
}

.student-tags {
    margin-top: 10px;
    display: flex;
    gap: 8px;
}

.tag {
    font-size: 11px;
    padding: 4px 10px;
    border-radius: 999px;
}

.tag-online { background: #d1fae5; color: #065f46; }
.tag-advanced { background: #e0e7ff; color: #3730a3; }

.student-hover-popup {
    position: absolute;
    top: 30%;
    left: 50%;
    margin-left: 5px;

    width: 260px;
    padding: 14px;
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 12px 40px rgba(0,0,0,0.22);

    opacity: 0;
    pointer-events: none;
    transform: translateY(15px);
    transition: 0.25s ease;
    z-index: 9999;
}

.student-card:hover .student-hover-popup {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
}

.popup-header {
    display: flex;
    align-items: center;
    gap: 10px;
}

.popup-avatar {
    width: 32px;
    height: 32px;
    background: #e5e7eb;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
}

.popup-details {
    font-size: 12px;
    margin-top: 10px;
}

.popup-courses {
    margin-top: 12px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.course-badge {
    font-size: 10px;
    padding: 3px 7px;
    background: #4f46e5;
    color: #fff;
    border-radius: 10px;
    text-decoration: none;
}
.popup-section-title {
    margin-top: 12px;
    margin-bottom: 6px;
    font-size: 13px;
    font-weight: 600;
    color: #374151; /* gray-700 */
    border-left: 3px solid #4f46e5; /* purple accent */
    padding-left: 6px;
}

</style>

</head>
<body class="bg-light">

<div class="d-flex justify-content-between align-items-center p-3 bg-white shadow-sm">
    <h3 class="m-0 fw-bold">Bildung</h3>

    <div class="dropdown">
        <button class="btn rounded-circle shadow"
                style="background:gray;color:white;width:45px;height:45px;"
                data-bs-toggle="dropdown">
            {{ request.user.username|first|upper }}
        </button>

        <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="#">Profile</a></li>
                <li><a class="dropdown-item" href="{% url 'instructor:add_course' %}">Create New Course</a></li>
                <li><a class="dropdown-item" href="{% url 'instructor:my_activity' %}">My Activity</a></li>
                <li><a class="dropdown-item" href="{% url 'instructor:students_list' %}">My Students</a></li>
                <li><a class="dropdown-item" href="{% url 'instructor:calendar_view' %}">My Schedules</a></li>
                <li><a class="dropdown-item" href="#">Notifications</a></li>
                <li><a class="dropdown-item" href="#">Earnings & Payments</a></li>
                <li><a class="dropdown-item" href="#">Help & Support</a></li>
                <li><a class="dropdown-item" href="#">Account Settings</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item text-danger" href="{% url 'logout_view' %}">Logout</a></li>
        </ul>
    </div>
</div>


<div class="main-content">

<div class="title-search-row">
    <h2 class="page-title">Student Profiles</h2>

    <form method="get" class="search-bar-inline">
        <div class="search-bar-inner">
            <i class="fas fa-search"></i>
            <input type="text" name="q" value="{{ query }}" placeholder="Search students...">
        </div>
    </form>
</div>

    <div class="stats">
        <div class="stat-card stat-1">
            <div class="stat-icon"><i class="fas fa-user-graduate"></i></div>
            <div class="stat-info"><h3>{{ students_data|length }}</h3><p>Total Students</p></div>
        </div>
        <div class="stat-card stat-2">
            <div class="stat-icon"><i class="fas fa-book-open"></i></div>
            <div class="stat-info"><h3>{{ total_courses }}</h3><p>Active Courses</p></div>
        </div>
        <div class="stat-card stat-3">
            <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
            <div class="stat-info"><h3>{{ average_progress }}%</h3><p>Average Progress</p></div>
        </div>
        <div class="stat-card stat-4">
            <div class="stat-icon"><i class="fas fa-tasks"></i></div>
            <div class="stat-info"><h3>{{ total_assignments }}</h3><p>Assignments Graded</p></div>
        </div>
    </div>

    <!-- STUDENT GRID -->
    <div class="students-grid">

        {% for s in students_data %}
        <div class="student-card">

            <div class="top-banner">
                <div class="student-avatar"><i class="fas fa-user"></i></div>
            </div>

            <div class="student-info">
                <h3 class="student-name">{{ s.student.get_full_name|default:s.student.username }}</h3>
                <p class="student-email">{{ s.student.email }}</p>

                {% if s.courses %}
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ s.courses.0.progress }}%"></div>
                </div>
                <div class="progress-text">{{ s.courses.0.progress }}% completed</div>
                {% endif %}

                <div class="student-tags">
                    <span class="tag tag-online">Online</span>
                    <span class="tag tag-advanced">Enrolled</span>
                </div>
            </div>

            <!-- POPUP -->
            <div class="student-hover-popup">
                <div class="popup-header">
                    <div class="popup-avatar"><i class="fas fa-user"></i></div>
                    <div>
                        <h3>{{ s.student.get_full_name|default:s.student.username }}</h3>
                        <p>{{ s.student.email }}</p>
                    </div>
                </div>

                <div class="popup-details">
                    <div>Enrolled: {{ s.courses|length }}</div>
                    <div>Completed: {{ s.completed_courses }}</div>
                    <div>Last active: {{ s.last_login }}</div>
                </div>
                <div class="popup-section-title">
                  Track Engagement
                </div>

                <div class="popup-courses">
                    {% for course in s.courses %}
                        <a href="{% url 'instructor:student_history' course.course_id s.student.id %}" class="course-badge">
                            {{ course.course_name|default:course.course.title }}
                        </a>
                    {% endfor %}
                </div>
            </div>

        </div>
        {% endfor %}

    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
